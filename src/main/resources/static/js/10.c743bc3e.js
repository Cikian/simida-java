"use strict";(self["webpackChunksimida_web"]=self["webpackChunksimida_web"]||[]).push([[10],{8713:function(e,t,a){a.d(t,{_:function(){return l}});var s=a(1020);const l=(0,s.Q_)("websocket",{state:()=>({msg:""}),getters:{},actions:{}})},6689:function(e,t,a){var s=a(8713);let l="ws://101.43.187.158:8005/ws";const n={websocket:null,init:()=>{n.websocket=new WebSocket(l),n.websocket.onmessage=e=>{console.log(e);JSON.parse(e.data);const t=(0,s._)();console.log("e.data",e.data),t.msg=e.data},n.websocket.onclose=e=>{console.log(e)}},send:e=>{0===n.websocket.readyState?setTimeout((()=>{n.websocket.send(JSON.stringify(e))}),1e3):n.websocket.send(JSON.stringify(e))}};t.Z=n},5010:function(e,t,a){a.r(t),a.d(t,{default:function(){return S}});var s=a(3396),l=a(7139),n=a(4870),o=a(9242),u=a(2483),i=a(4471),c=a(243),r=a(6689),d=a(8713),v=a(5878),g=a(1192),m=a(6482);const p={class:"chat"},b={align:"center",style:{height:"40px",lineHeight:"50px"}},w=["src"],f={class:"chat-boom"},h={class:"buttons-box"};var y={__name:"index",setup(e){const t=(0,n.iH)({search:"请输入关键字",categories:{Activity:"Atividades",Flags:"旗帜",Foods:"食物",Frequently:"Frequentes",Objects:"Objetos",Nature:"Natureza",Peoples:"Pessoas",Symbols:"Símbolos",Places:"Locais"}});function a(e){let t=document.getElementById("msgInput"),a=t.selectionStart,s=t.selectionEnd,l=t.value.substring(0,a)+e.i+t.value.substring(s);t.value=l,t.focus(),t.selectionStart=a+e.n.length,t.selectionEnd=a+e.n.length,U.value=l}let y=(0,u.tv)();const k=(0,n.iH)(""),_=(0,n.iH)(null),S=(0,n.iH)({list:[]}),N=(0,n.qj)({to:k,pageNum:1,pageSize:10}),H=(0,d._)(),I=(0,n.iH)("");let U=(0,n.iH)("");const W=(0,n.iH)(!0),Z=()=>{I.value=y.currentRoute.value.query.uid,S.value.list=[],k.value=y.currentRoute.value.query.uid};(0,u.ao)((e=>{S.value.list=[],k.value=e.query.uid,x(k.value),z()})),(0,s.bv)((()=>{Z(),x(k.value),z()}));const q=(0,n.iH)({userName:"",userId:"",nickName:"",avatar:""}),x=e=>{i.Z.get("/user/"+e).then((e=>{2001===e.data.code&&(q.value=e.data.data.userInfo)}))};H.$subscribe(((e,t)=>{let a=JSON.parse(t.msg);2===a.type&&z()}));const z=()=>{i.Z.get("/message/getMesList/"+k.value+"/"+N.pageNum+"/"+N.pageSize).then((e=>{2001===e.data.code&&(S.value.list=e.data.data.mesList)})).then((()=>{_.value&&_.value.setScrollTop(9999999999)}))},O=({scrollTop:e})=>{},C=()=>{!0!==W.value&&i.Z.post("/message/sendMes",{toId:k.value,content:U.value}).then((e=>{U.value="",W.value=!0,3001===e.data.code&&z()})).then((()=>{r.Z.send({from:(0,v.le)("uid"),to:k.value,message:U.value,type:2})}))},D=e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),C())};return(e,u)=>{const i=(0,s.up)("el-input"),r=(0,s.up)("a-button"),d=(0,s.up)("a-popover"),v=(0,s.up)("el-button");return(0,s.wg)(),(0,s.iD)("div",p,[(0,s._)("h3",b,(0,l.zw)(q.value.nickName),1),(0,s.Wm)((0,n.SU)(c.Mr),{ref_key:"scrollbarRef",ref:_,onScroll:O,style:{"background-color":"rgba(199,199,199,0.32)"}},{default:(0,s.w5)((()=>[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(S.value.list,((e,t)=>((0,s.wg)(),(0,s.iD)("div",{class:"chat-list",key:t},[(0,s._)("div",{class:(0,l.C_)([e.fromId===N.to?"chat-list-left":"chat-list-right"])},[(0,s._)("img",{src:e.avatar,class:"list-img"},null,8,w),(0,s._)("div",{class:(0,l.C_)(e.fromId===N.to?"left-msg":"right-msg"),style:{"white-space":"pre-wrap"}},(0,l.zw)(e.content),3)],2)])))),128))])),_:1},512),(0,s._)("div",f,[(0,s.Wm)(i,{class:"textarea",type:"textarea",rows:7,placeholder:"Please input",modelValue:(0,n.SU)(U),"onUpdate:modelValue":u[0]||(u[0]=e=>(0,n.dq)(U)?U.value=e:U=e),resize:"none",onKeydown:u[1]||(u[1]=(0,o.D2)((e=>D(e)),["enter","native"])),onInput:u[2]||(u[2]=e=>W.value=""===(0,n.SU)(U)),id:"msgInput"},null,8,["modelValue"]),(0,s._)("div",h,[(0,s.Wm)(d,{trigger:"click",placement:"bottom"},{content:(0,s.w5)((()=>[(0,s.wy)((0,s.Wm)((0,n.SU)(m.Z),{native:!0,i18n:t.value,onSelect:a},null,8,["i18n"]),[[o.F8,!0]])])),default:(0,s.w5)((()=>[(0,s.Wm)(r,{class:"face-btn"},{icon:(0,s.w5)((()=>[(0,s.Wm)((0,n.SU)(g.Z))])),default:(0,s.w5)((()=>[(0,s.Uk)("表情 ")])),_:1})])),_:1}),(0,s.Wm)(v,{class:"send-btn",type:"primary",onClick:C,disabled:W.value},{default:(0,s.w5)((()=>[(0,s.Uk)("发送")])),_:1},8,["disabled"])])])])}}},k=a(89);const _=(0,k.Z)(y,[["__scopeId","data-v-71fac628"]]);var S=_}}]);
//# sourceMappingURL=10.c743bc3e.js.map