{"version":3,"file":"js/10.c743bc3e.js","mappings":"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","sources":["webpack://simida-web/./src/store/websocket.js","webpack://simida-web/./src/utils/websocket.js","webpack://simida-web/./src/views/chatModel/chat/index.vue","webpack://simida-web/./src/views/chatModel/chat/index.vue?8ece"],"sourcesContent":["import {defineStore} from \"pinia\";\n\n\nexport const websocketStore = defineStore(\"websocket\", {\n    state: () => {\n        return ({\n            msg: '',\n        })\n    },\n    getters: {},\n    actions: {}\n})\n","import {websocketStore} from \"@/store/websocket\";\n\nlet url = \"ws://101.43.187.158:8005/ws\";  //请求的后端地址\n\nconst socket = {\n    websocket: null,\n    init: () => {\n        socket.websocket = new WebSocket(url);\n        socket.websocket.onmessage = (e) => {\n            console.log(e);\n            let data = JSON.parse(e.data);\n            // if (data.type === 3) {\n            //     window.location.href = \"/chat/call?from=\" + data.from + \"&type=2\";\n            // } else {\n            const web = websocketStore();\n            console.log(\"e.data\", e.data);\n            web.msg = e.data;\n            // }\n        };\n        socket.websocket.onclose = (e) => {\n            console.log(e);\n        };\n    },\n\n    send: (e) => {\n        if (socket.websocket.readyState === 0) {\n            setTimeout(() => {\n                socket.websocket.send(JSON.stringify(e));\n            }, 1000);\n        } else {\n            socket.websocket.send(JSON.stringify(e));\n        }\n    }\n};\n\nexport default socket;\n","<template>\n  <div class=\"chat\">\n    <h3 align=\"center\" :style=\"{height:'40px',lineHeight:'50px'}\">{{ userInfo.nickName }}</h3>\n    <el-scrollbar ref=\"scrollbarRef\" @scroll=\"scroll\" style=\"background-color: rgba(199,199,199,0.32)\">\n      <div class=\"chat-list\" v-for=\"(item,index) in mesArr.list\" :key=\"index\">\n        <div :class=\"[item.fromId === query.to?'chat-list-left':'chat-list-right']\">\n          <img :src=\"item.avatar\" class=\"list-img\">\n          <div :class=\"item.fromId === query.to?'left-msg':'right-msg'\" style=\"white-space: pre-wrap;\">{{ item.content }}</div>\n        </div>\n      </div>\n    </el-scrollbar>\n\n    <div class=\"chat-boom\">\n      <el-input\n          class=\"textarea\"\n          type=\"textarea\"\n          :rows=\"7\"\n          placeholder=\"Please input\"\n          v-model=\"text\"\n          resize=\"none\"\n          @keydown.enter.native=\"textareaKeydown($event)\"\n          @input=\"textIsBlank = text === ''\"\n          id=\"msgInput\"\n      />\n      <!--      <el-button type=\"primary\" @click=\"callVideo\">视频通话</el-button>-->\n      <div class=\"buttons-box\">\n        <a-popover trigger=\"click\" placement=\"bottom\">\n          <a-button class=\"face-btn\">表情\n            <template #icon>\n              <SmileOutlined/>\n            </template>\n          </a-button>\n          <template #content>\n            <EmojiPicker\n                :native=\"true\"\n                v-show=\"true\"\n                :i18n=\"i18n\"\n                @select=\"onSelectEmoji\"\n            />\n          </template>\n        </a-popover>\n        <el-button class=\"send-btn\"\n            type=\"primary\" @click=\"send\" :disabled=\"textIsBlank\">发送</el-button>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script lang=\"js\" setup>\n\nimport {onBeforeRouteUpdate, useRouter} from \"vue-router\";\nimport {onMounted, reactive, ref} from \"vue\";\nimport requestService from \"@/utils/request\";\nimport {ElScrollbar} from \"element-plus\";\nimport socket from \"@/utils/websocket\";\nimport {websocketStore} from \"@/store/websocket\";\nimport {getLocalStorageItem} from \"@/utils/data\";\nimport {SmileOutlined} from \"@ant-design/icons-vue\";\n\n\nimport EmojiPicker from 'vue3-emoji-picker'\nimport 'vue3-emoji-picker/css'\n\nconst i18n= ref({\n  search: '请输入关键字',\n  categories: {\n    Activity: \"Atividades\",\n    Flags: \"旗帜\",\n    Foods: \"食物\",\n    Frequently: \"Frequentes\",\n    Objects: \"Objetos\",\n    Nature: \"Natureza\",\n    Peoples: \"Pessoas\",\n    Symbols: \"Símbolos\",\n    Places: \"Locais\"\n  }\n})\nfunction onSelectEmoji(emoji) {\n\n  let input = document.getElementById(\"msgInput\")\n  let startPos = input.selectionStart\n  let endPos = input.selectionEnd\n  let resultText = input.value.substring(0, startPos) + emoji.i + input.value.substring(endPos)\n  input.value = resultText\n  input.focus()\n  input.selectionStart = startPos + emoji.n.length\n  input.selectionEnd = startPos + emoji.n.length\n  text.value = resultText\n\n}\n\nlet router = useRouter();\nconst uid = ref('');\nconst scrollbarRef = ref(null);\nconst mesArr = ref({list: []});\nconst query = reactive({to: uid, pageNum: 1, pageSize: 10});\n\nconst web = websocketStore();\n\nconst active = ref('');\nlet text = ref('');\nconst textIsBlank = ref(true);\n\nconst getUid = () => {\n  active.value = router.currentRoute.value.query.uid;\n  mesArr.value.list = [];\n  // 获取路由参数uid\n  uid.value = router.currentRoute.value.query.uid;\n};\n\nonBeforeRouteUpdate((to) => {\n  mesArr.value.list = [];\n  uid.value = to.query.uid;\n  getUserInfo(uid.value);\n  getList();\n});\n\n\nonMounted(() => {\n  getUid();\n  getUserInfo(uid.value);\n  getList();\n});\n\nconst userInfo = ref({\n  userName: \"\",\n  userId: \"\",\n  nickName: \"\",\n  avatar: \"\",\n})\n\nconst getUserInfo = (uid) => {\n  requestService.get(\"/user/\" + uid).then((res) => {\n    if (res.data.code === 2001) {\n      userInfo.value = res.data.data.userInfo;\n    }\n  })\n}\n\nweb.$subscribe((mutations, state) => {\n  let msg = JSON.parse(state.msg);\n  if (msg.type === 2) {\n    getList();\n  }\n});\n\nconst getList = () => {\n  requestService.get('/message/getMesList/' + uid.value + \"/\" + query.pageNum + \"/\" + query.pageSize).then(res => {\n    if (res.data.code === 2001) {\n      mesArr.value.list = res.data.data.mesList;\n    }\n  }).then(() => {\n    scrollbarRef.value && scrollbarRef.value.setScrollTop(9999999999);\n  });\n};\n\nconst scroll = ({scrollTop}) => {\n  // 在此处理滚动事件\n};\n\nconst send = () => {\n  if (textIsBlank.value === true) {\n    return;\n  }\n  requestService.post('/message/sendMes', {toId: uid.value, content: text.value}).then(res => {\n    text.value = '';\n    textIsBlank.value = true;\n    if (res.data.code === 3001) {\n      getList();\n    }\n  }).then(() => {\n    socket.send({from: getLocalStorageItem(\"uid\"), to: uid.value, message: text.value, type: 2});\n  });\n};\n\nconst textareaKeydown = (e) => {\n  // 如果按下Enter键，且没有按下Shift键\n  if (e.key === \"Enter\" && !e.shiftKey) {\n    e.preventDefault(); // 阻止默认的换行行为\n    send(); // 执行 \"send\" 方法\n  }\n};\n\n\n// 视频通话（待定）\n// const callVideo = () => {\n//   console.log(\"视频通话\")\n//   router.push({path:\"call\",query:{from:query.to,type:1}}) // type 1 为开始请求通话  2 为回应通话\n// }\n</script>\n\n<style scoped>\n.chat {\n  background: rgb(247, 247, 247);\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  justify-content: space-between;\n}\n\n.chat-boom {\n  display: flex;\n  justify-content: space-between;\n  align-items: flex-end;\n  position: relative;\n}\n\n.list-img {\n  width: 40px;\n  height: 40px;\n  border-radius: 999px;\n}\n\n.chat-list {\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n}\n\n.chat-list-left {\n  padding: 20px;\n  display: flex;\n  flex-direction: row;\n}\n\n.chat-list-right {\n  padding: 20px;\n  display: flex;\n  flex-direction: row-reverse;\n}\n\n.left-msg {\n  font-size: 15px;\n  max-width: 350px;\n\n  background-color: #fff; /* 设置气泡背景颜色 */\n  border: none; /* 设置边框 */\n  border-radius: 8px; /* 设置圆角 */\n  padding: 10px; /* 设置内边距 */\n  word-wrap: break-word; /* 自动换行 */\n  margin: 0 15px; /* 设置外边距 */\n  position: relative;\n}\n\n.left-msg::after {\n  content: ''; /* 伪元素内容为空 */\n  position: absolute; /* 设置绝对定位 */\n  border-width: 8px; /* 边框宽度控制尖角的大小 */\n  border-style: solid; /* 边框样式 */\n  border-color: transparent #fff transparent transparent; /* 边框颜色控制尖角的颜色 */\n  left: -16px; /* 控制尖角的位置 */\n  top: 10px; /* 控制尖角的位置 */\n}\n\n.right-msg {\n  font-size: 15px;\n  max-width: 350px;\n\n  background-color: #95ec69; /* 设置气泡背景颜色 */\n  border: none; /* 设置边框 */\n  border-radius: 8px; /* 设置圆角 */\n  padding: 10px; /* 设置内边距 */\n  word-wrap: break-word; /* 自动换行 */\n  margin: 0 15px; /* 设置外边距 */\n  position: relative;\n}\n\n.right-msg::after {\n  content: ''; /* 伪元素内容为空 */\n  position: absolute; /* 设置绝对定位 */\n  border-width: 8px; /* 边框宽度控制尖角的大小 */\n  border-style: solid; /* 边框样式 */\n  border-color: transparent transparent transparent #95ec69; /* 边框颜色控制尖角的颜色 */\n  right: -16px; /* 控制尖角的位置 */\n  top: 10px; /* 控制尖角的位置 */\n}\n\n.buttons-box {\n  position: absolute;\n  right: 10px;\n  bottom: 10px;\n}\n\n.send-btn:disabled{\n  border: none;\n  background-color: rgba(222, 28, 49, 0.54);\n  color: white;\n}\n\n.send-btn:disabled:hover{\n  border: none;\n  background-color: rgba(222, 28, 49, 0.54);\n  color: white;\n}\n\n.send-btn:hover{\n  border: none;\n  background-color: #b62032;\n  color: white;\n}\n\n.send-btn{\n  border: none;\n  background-color: #de1c31;\n  color: white;\n}\n\ntextarea{\n  border: none;\n  -webkit-box-shadow: none;\n  box-shadow: none;\n}\n\n.textarea:focus{\n  border: 1px #de1c31 solid;\n  -webkit-box-shadow: none;\n  box-shadow: none;\n}\n\n</style>\n","import script from \"./index.vue?vue&type=script&lang=js&setup=true\"\nexport * from \"./index.vue?vue&type=script&lang=js&setup=true\"\n\nimport \"./index.vue?vue&type=style&index=0&id=71fac628&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-71fac628\"]])\n\nexport default __exports__"],"names":["websocketStore","defineStore","state","msg","getters","actions","url","socket","websocket","init","WebSocket","onmessage","e","console","log","JSON","parse","data","web","onclose","send","readyState","setTimeout","stringify","i18n","ref","search","categories","Activity","Flags","Foods","Frequently","Objects","Nature","Peoples","Symbols","Places","onSelectEmoji","emoji","input","document","getElementById","startPos","selectionStart","endPos","selectionEnd","resultText","value","substring","i","focus","n","length","text","router","useRouter","uid","scrollbarRef","mesArr","list","query","reactive","to","pageNum","pageSize","active","textIsBlank","getUid","currentRoute","onBeforeRouteUpdate","getUserInfo","getList","onMounted","userInfo","userName","userId","nickName","avatar","requestService","get","then","res","code","$subscribe","mutations","type","mesList","setScrollTop","scroll","scrollTop","post","toId","content","from","getLocalStorageItem","message","textareaKeydown","key","shiftKey","preventDefault","__exports__"],"sourceRoot":""}